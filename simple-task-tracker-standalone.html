<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="„Ç∑„É≥„Éó„É´„Åß‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑÂÄã‰∫∫Áî®„Çø„Çπ„ÇØÁÆ°ÁêÜ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥">
  <meta name="keywords" content="„Çø„Çπ„ÇØÁÆ°ÁêÜ,TODO,ÁîüÁî£ÊÄß,Êó•Êú¨Ë™û">
  <meta name="author" content="Simple Task Tracker">
  <title>„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº - Êó•„ÄÖ„ÅÆ„Çø„Çπ„ÇØ„ÇíÁ∞°Âçò„Å´ÁÆ°ÁêÜ</title>

  <!-- Accessibility improvements -->
  <meta name="theme-color" content="#2563eb">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">

  <style>
    /* Task Tracker Styles - Consolidated Single File Version */

    /* Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Accessibility - Screen reader only content */
    .visually-hidden {
      position: absolute !important;
      width: 1px !important;
      height: 1px !important;
      padding: 0 !important;
      margin: -1px !important;
      overflow: hidden !important;
      clip: rect(0, 0, 0, 0) !important;
      white-space: nowrap !important;
      border: 0 !important;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f8fafc;
      padding: 20px;
      min-height: 100vh;
    }

    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* App Header */
    .app-header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem 0;
    }

    .app-title {
      color: #2563eb;
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 4px rgba(37, 99, 235, 0.1);
    }

    .app-subtitle {
      color: #6b7280;
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Task Input Section */
    .task-input-section {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }

    .task-input-section:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    /* Input Container */
    .input-container {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .task-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #fafafa;
    }

    .task-input:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      background: white;
    }

    .task-input::placeholder {
      color: #9ca3af;
      font-style: italic;
    }

    .task-input.error {
      border-color: #dc2626;
      background: #fef2f2;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    /* Add Task Button */
    .add-task-btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .add-task-btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .add-task-btn:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
      border-radius: 4px;
    }

    / * Task List Section */ .task-list-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      border: 1px solid #e5e7eb;
      transition: all 0.3s ease;
    }

    .task-list-section:hover {
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    .task-list-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid #e5e7eb;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title {
      color: #1f2937;
      font-size: 1.5rem;
      font-weight: 600;
      margin: 0;
    }

    .task-counter {
      color: #6b7280;
      font-size: 0.875rem;
      font-weight: 500;
      background: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      border: 1px solid #e5e7eb;
      transition: transform 0.2s ease;
    }

    /* Task List */
    .task-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .task-item {
      display: flex;
      align-items: center;
      padding: 1rem 2rem;
      border-bottom: 1px solid #f3f4f6;
      transition: all 0.3s ease;
      position: relative;
    }

    .task-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #2563eb;
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .task-item:hover {
      background: #f9fafb;
      transform: translateX(4px);
    }

    .task-item:hover::before {
      transform: scaleY(1);
    }

    .task-item:last-child {
      border-bottom: none;
    }

    /* Completed task styling */
    .task-item.completed {
      background: #f8f9fa;
      opacity: 0.8;
    }

    .task-item.completed::before {
      background: #10b981;
      transform: scaleY(1);
    }

    .task-item.completed:hover {
      background: #f1f3f4;
    }

    .task-content {
      flex: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .task-content:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
      border-radius: 4px;
    }

    /*
 Task Toggle Button */
    .task-toggle {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #d1d5db;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      font-size: 12px;
      font-weight: bold;
    }

    .task-checkbox.completed {
      background: #10b981;
      border-color: #10b981;
      color: white;
      transform: scale(1.1);
    }

    /* Task Details */
    .task-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .task-description {
      font-size: 1rem;
      transition: all 0.3s ease;
      line-height: 1.4;
    }

    .task-description.completed {
      text-decoration: line-through;
      color: #6b7280;
    }

    .task-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.75rem;
      color: #9ca3af;
    }

    .task-status {
      font-weight: 500;
      padding: 0.125rem 0.5rem;
      border-radius: 12px;
      background: #f3f4f6;
    }

    .task-status.completed {
      background: #d1fae5;
      color: #065f46;
    }

    .task-status.todo {
      background: #fef3c7;
      color: #92400e;
    }

    .task-date {
      color: #9ca3af;
    }

    /* Task Delete Button */
    .task-delete {
      background: #ef4444;
      color: white;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .task-delete:hover {
      background: #dc2626;
      transform: scale(1.05);
    }

    .task-delete:focus {
      outline: 2px solid #2563eb;
      outline-offset: 2px;
    }

    .delete-icon {
      font-size: 1rem;
      font-weight: bold;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #6b7280;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      opacity: 0.6;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .empty-state-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: #374151;
      font-weight: 600;
    }

    .empty-state-message {
      font-size: 1rem;
      line-height: 1.6;
      max-width: 400px;
      margin: 0 auto;
      color: #6b7280;
    }

    /* Message System */
    .error-message,
    .warning-message,
    .success-message {
      padding: 1rem 1.5rem;
      border-radius: 8px;
      margin: 1rem 0;
      font-weight: 500;
      display: none;
      animation: slideIn 0.3s ease-out;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      line-height: 1.5;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .error-message {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }

    .warning-message {
      background: #fffbeb;
      color: #d97706;
      border: 1px solid #fed7aa;
    }

    .success-message {
      background: #f0fdf4;
      color: #16a34a;
      border: 1px solid #bbf7d0;
    }

    .error-message.show,
    .warning-message.show,
    .success-message.show {
      display: block;
    }

    /* App Footer */
    .app-footer {
      text-align: center;
      padding: 2rem 0;
      margin-top: 3rem;
      border-top: 1px solid #e5e7eb;
    }

    .footer-text {
      color: #9ca3af;
      font-size: 0.875rem;
      transition: color 0.3s ease;
    }

    .footer-text.storage-unavailable {
      color: #d97706;
      font-weight: 500;
    }

    /* 
Skip to main content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: #2563eb;
      color: white;
      padding: 8px;
      text-decoration: none;
      border-radius: 4px;
      z-index: 1000;
      transition: top 0.3s;
    }

    .skip-link:focus {
      top: 6px;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 0 15px;
      }

      .app-title {
        font-size: 2rem;
      }

      .app-header {
        padding: 1.5rem 0;
      }

      .task-input-section,
      .task-list-section {
        padding: 1.5rem;
      }

      .task-list-header {
        padding: 1rem 1.5rem;
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
      }

      .task-item {
        padding: 1rem 1.5rem;
      }

      .task-item:hover {
        transform: none;
      }

      .task-meta {
        flex-direction: column;
        gap: 0.25rem;
      }

      .input-container {
        flex-direction: column;
        gap: 0.75rem;
      }

      .add-task-btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 15px;
      }

      .app-title {
        font-size: 1.75rem;
      }

      .task-input-section,
      .task-list-section {
        padding: 1rem;
      }

      .task-item {
        padding: 0.75rem 1rem;
      }

      .empty-state {
        padding: 3rem 1rem;
      }

      .empty-state-icon {
        font-size: 3rem;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }

      .empty-state-icon {
        animation: none;
      }
    }
  </style>
</head>

<body>

  <a href="#main-content" class="skip-link">„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Å´„Çπ„Ç≠„ÉÉ„Éó</a>
  <div class="container">
    <header class="app-header">
      <h1 class="app-title">„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº</h1>
      <p class="app-subtitle">Êó•„ÄÖ„ÅÆ„Çø„Çπ„ÇØ„ÇíÁ∞°Âçò„Å´ÁÆ°ÁêÜ</p>
    </header>

    <main id="main-content" class="app-main" role="main">
      <!-- „Çø„Çπ„ÇØÂÖ•Âäõ„Ç®„É™„Ç¢ -->
      <section class="task-input-section" aria-labelledby="input-section-title">
        <h2 id="input-section-title" class="visually-hidden">Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÅÆËøΩÂä†</h2>
        <div class="input-container">
          <label for="taskInput" class="visually-hidden">„Çø„Çπ„ÇØ„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</label>
          <input type="text" id="taskInput" class="task-input" placeholder="Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..." maxlength="200"
            autocomplete="off" aria-describedby="input-help">
          <div id="input-help" class="visually-hidden">ÊúÄÂ§ß200ÊñáÂ≠ó„Åæ„ÅßÂÖ•Âäõ„Åß„Åç„Åæ„Åô„ÄÇEnter„Ç≠„Éº„Åæ„Åü„ÅØËøΩÂä†„Éú„Çø„É≥„Åß„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åô„ÄÇ</div>
          <button type="button" id="addTaskBtn" class="add-task-btn" aria-label="Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†">
            <span aria-hidden="true">ËøΩÂä†</span>
          </button>
        </div>
      </section>

      <!-- „Çø„Çπ„ÇØ„É™„Çπ„ÉàË°®Á§∫„Ç®„É™„Ç¢ -->
      <section class="task-list-section" aria-labelledby="task-list-title">
        <div class="task-list-header">
          <h2 id="task-list-title" class="section-title">„Çø„Çπ„ÇØ‰∏ÄË¶ß</h2>
          <div class="task-counter" aria-live="polite" aria-atomic="true">
            <span id="taskCount">0</span> ‰ª∂„ÅÆ„Çø„Çπ„ÇØ
          </div>
        </div>

        <!-- „Çø„Çπ„ÇØ„É™„Çπ„Éà„Ç≥„É≥„ÉÜ„Éä -->
        <ul id="taskList" class="task-list" role="list" aria-label="„Çø„Çπ„ÇØ„É™„Çπ„Éà">
          <!-- „Çø„Çπ„ÇØ„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
        </ul>

        <!-- Á©∫Áä∂ÊÖãË°®Á§∫ -->
        <div id="emptyState" class="empty-state" role="status" aria-live="polite">
          <div class="empty-state-icon" aria-hidden="true">üìù</div>
          <h3 class="empty-state-title">„Åæ„Å†„Çø„Çπ„ÇØ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
          <p class="empty-state-message">
            ÊúÄÂàù„ÅÆ„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Å¶„ÄÅÁîüÁî£ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜÔºÅ<br>
            ‰∏ä„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ„Åó„Å¶Enter„Ç≠„Éº„ÇíÊäº„Åô„Åã„ÄÅ„ÄåËøΩÂä†„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          </p>
        </div>
      </section>

      <!-- „Ç®„É©„ÉºË°®Á§∫„Ç®„É™„Ç¢ -->
      <div id="error-message" class="error-message" role="alert" aria-live="polite">
        <!-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
      </div>

      <!-- Ë≠¶ÂëäË°®Á§∫„Ç®„É™„Ç¢ -->
      <div id="warning-message" class="warning-message" role="alert" aria-live="polite">
        <!-- Ë≠¶Âëä„É°„ÉÉ„Çª„Éº„Ç∏„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
      </div>
    </main>

    <footer class="app-footer">
      <p class="footer-text">
        „Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº - „Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô
      </p>
    </footer>
  </div>

  <script>
    // Task Tracker Script - Consolidated Single File Version

    // Task Manager Object
    const TaskManager = {
      tasks: [],
      nextId: 1,
      isComposing: false, // IMEÂÖ•ÂäõÁä∂ÊÖã„ÇíËøΩË∑°

      // Data versioning constants
      STORAGE_KEY: 'simple-task-tracker-data',
      CURRENT_VERSION: '1.0',
      SUPPORTED_VERSIONS: ['1.0'],

      // Initialize the application
      init() {
        console.log('„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº„ÇíÂàùÊúüÂåñ‰∏≠... üìù');

        try {
          // Check storage availability first
          const storageAvailable = this.isStorageAvailable();
          if (!storageAvailable) {
            console.warn('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
            this.showStorageWarning('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éá„Éº„Çø„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åõ„Çì„ÄÇ');
            this.updateStorageStatus(false);
          } else {
            this.updateStorageStatus(true);
          }

          // Load data from storage
          const loadSuccess = this.loadFromStorage();

          // Bind events
          this.bindEvents();

          // Initial render
          this.render();

          // Success message
          const taskCount = this.tasks.length;
          const completedCount = this.tasks.filter(t => t.completed).length;
          console.log(`„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„ÅüÔºÅ üìù`);
          console.log(`„Çø„Çπ„ÇØ: ${taskCount}‰ª∂ (ÂÆå‰∫Ü: ${completedCount}‰ª∂)`);

          // Show welcome message if no tasks
          if (taskCount === 0 && loadSuccess) {
            console.log('Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ');
          }

          // Announce successful initialization to screen readers
          this.announceToScreenReader('„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº„ÅåÊ≠£Â∏∏„Å´Ë™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„Åü');

        } catch (error) {
          this.handleCriticalError(error, '„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ');
        }
      },

      // Event binding
      bindEvents() {
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');

        // Add task button click
        addTaskBtn.addEventListener('click', (e) => {
          e.preventDefault();
          this.handleAddTaskWithFeedback(e.target);
        });

        // IMEÂÖ•ÂäõÁä∂ÊÖã„ÅÆËøΩË∑°
        taskInput.addEventListener('compositionstart', () => {
          this.isComposing = true;
        });

        taskInput.addEventListener('compositionend', () => {
          this.isComposing = false;
        });

        // Enter key handling with IME support
        taskInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !this.isComposing) {
            e.preventDefault();
            this.handleAddTaskWithFeedback(addTaskBtn);
          }
        });

        // Real-time input validation
        taskInput.addEventListener('input', (e) => {
          this.handleInputValidation(e.target);
        });

        // Task list event delegation
        taskList.addEventListener('click', (e) => {
          e.preventDefault();
          const taskItem = e.target.closest('.task-item');
          if (!taskItem) return;

          const taskId = parseInt(taskItem.dataset.taskId);

          // Handle task completion toggle
          if (e.target.closest('.task-toggle') || e.target.closest('.task-content')) {
            this.handleTaskToggleWithAnimation(taskId, taskItem);
          }
          // Handle task deletion
          else if (e.target.closest('.task-delete')) {
            this.handleTaskDeleteWithAnimation(taskId, taskItem);
          }
        });

        // Focus management
        taskInput.addEventListener('focus', () => {
          taskInput.parentElement.classList.add('focused');
        });

        taskInput.addEventListener('blur', () => {
          taskInput.parentElement.classList.remove('focused');
        });

        console.log('„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Éº„ÇíË®≠ÂÆö„Åó„Åæ„Åó„Åü üéØ');
      },
      // Enhanced task addition with validation and feedback
      handleAddTaskWithFeedback(buttonElement) {
        const taskInput = document.getElementById('taskInput');
        const description = taskInput.value.trim();

        // Clear any existing error states
        taskInput.classList.remove('error');
        this.hideMessages();

        // Comprehensive input validation
        const validationResult = this.validateTaskInput(description);
        if (!validationResult.isValid) {
          this.showInputError(taskInput, validationResult.message);
          return;
        }

        // Visual feedback for button press
        buttonElement.style.transform = 'scale(0.95)';
        setTimeout(() => {
          buttonElement.style.transform = 'scale(1)';
        }, 150);

        const task = {
          id: this.nextId++,
          description: this.sanitizeInput(description),
          completed: false,
          createdAt: new Date(),
          completedAt: null
        };

        this.tasks.push(task);

        // Clear input with animation
        taskInput.style.transform = 'scale(0.98)';
        taskInput.value = '';
        setTimeout(() => {
          taskInput.style.transform = 'scale(1)';
          taskInput.focus();
        }, 100);

        // Save to storage
        const saveSuccess = this.saveToStorage();
        if (!saveSuccess) {
          console.warn('„Çø„Çπ„ÇØ„ÅØËøΩÂä†„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          this.showMessage('„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'warning');
        }

        this.render();
        console.log(`Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü: "${task.description}"`);

        // Show success feedback
        this.showSuccessMessage(`„Çø„Çπ„ÇØ„Äå${task.description}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);

        // Announce to screen readers
        this.announceToScreenReader('Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
      },

      // Input validation with real-time feedback
      handleInputValidation(inputElement) {
        const value = inputElement.value;
        const length = value.length;
        const maxLength = 200;

        // Remove error state if input becomes valid
        if (length > 0 && length <= maxLength) {
          inputElement.classList.remove('error');
        }

        // Show character counter near limit
        if (length > maxLength * 0.8) {
          const remaining = maxLength - length;
          if (remaining >= 0) {
            inputElement.title = `ÊÆã„Çä${remaining}ÊñáÂ≠ó`;
          } else {
            inputElement.title = `${Math.abs(remaining)}ÊñáÂ≠óË∂ÖÈÅé`;
            inputElement.classList.add('error');
          }
        } else {
          inputElement.title = '';
        }
      },
      // Enhanced task completion toggle with animation
      handleTaskToggleWithAnimation(id, taskElement) {
        const task = this.tasks.find(t => t.id === id);
        if (!task) {
          console.warn(`„Çø„Çπ„ÇØ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ID ${id}`);
          return;
        }

        // Immediate visual feedback
        taskElement.style.transform = 'scale(0.98)';
        const checkbox = taskElement.querySelector('.task-checkbox');

        // Toggle task state
        task.completed = !task.completed;
        task.completedAt = task.completed ? new Date() : null;

        // Animate checkbox change
        if (task.completed) {
          checkbox.style.transform = 'scale(1.2)';
          checkbox.textContent = '‚úì';
          checkbox.classList.add('completed');
          setTimeout(() => {
            checkbox.style.transform = 'scale(1)';
          }, 200);
        } else {
          checkbox.style.transform = 'scale(0.8)';
          checkbox.textContent = '';
          checkbox.classList.remove('completed');
          setTimeout(() => {
            checkbox.style.transform = 'scale(1)';
          }, 200);
        }

        // Reset task element scale
        setTimeout(() => {
          taskElement.style.transform = 'scale(1)';
        }, 150);

        // Save to storage
        const saveSuccess = this.saveToStorage();
        if (!saveSuccess) {
          console.warn('„Çø„Çπ„ÇØ„ÅÆÁä∂ÊÖã„ÅØÂ§âÊõ¥„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
          this.showMessage('Áä∂ÊÖã„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'warning');
        }

        // Re-render with updated state
        setTimeout(() => {
          this.render();
        }, 300);

        const statusText = task.completed ? 'ÂÆå‰∫Ü' : 'Êú™ÂÆå‰∫Ü';
        console.log(`„Çø„Çπ„ÇØ„ÅÆÁä∂ÊÖã„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„Åü: "${task.description}" ‚Üí ${statusText}`);

        // Show status change feedback
        const actionText = task.completed ? 'ÂÆå‰∫Ü„Åó„Åæ„Åó„Åü' : 'Êú™ÂÆå‰∫Ü„Å´Êàª„Åó„Åæ„Åó„Åü';
        this.showSuccessMessage(`„Çø„Çπ„ÇØ„Äå${task.description}„Äç„Çí${actionText}`);

        // Announce to screen readers
        this.announceToScreenReader(`„Çø„Çπ„ÇØ ${actionText}`);
      },

      // Enhanced task deletion with animation
      handleTaskDeleteWithAnimation(id, taskElement) {
        const taskIndex = this.tasks.findIndex(t => t.id === id);
        if (taskIndex === -1) {
          console.warn(`ÂâäÈô§„Åô„Çã„Çø„Çπ„ÇØ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ID ${id}`);
          return;
        }

        const deletedTask = this.tasks[taskIndex];

        // Animate task removal
        taskElement.style.transition = 'all 0.3s ease';
        taskElement.style.transform = 'translateX(-100%)';
        taskElement.style.opacity = '0';

        // Remove from array after animation
        setTimeout(() => {
          this.tasks.splice(taskIndex, 1);

          // Save to storage
          const saveSuccess = this.saveToStorage();
          if (!saveSuccess) {
            console.warn('„Çø„Çπ„ÇØ„ÅØÂâäÈô§„Åï„Çå„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            this.showMessage('„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„Åå„ÄÅ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'warning');
          }

          this.render();
          console.log(`„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü: "${deletedTask.description}"`);

          // Show deletion feedback
          this.showSuccessMessage(`„Çø„Çπ„ÇØ„Äå${deletedTask.description}„Äç„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`);

          // Announce to screen readers
          this.announceToScreenReader('„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        }, 300);
      },
      // Dynamic task list rendering
      render() {
        const taskList = document.getElementById('taskList');
        const emptyState = document.getElementById('emptyState');
        const taskCount = document.getElementById('taskCount');

        // Update task counter with animation
        if (taskCount) {
          const currentCount = parseInt(taskCount.textContent) || 0;
          const newCount = this.tasks.length;

          if (currentCount !== newCount) {
            taskCount.style.transform = 'scale(1.2)';
            taskCount.textContent = newCount;
            setTimeout(() => {
              taskCount.style.transform = 'scale(1)';
            }, 200);
          }
        }

        // Enhanced empty state handling
        if (this.tasks.length === 0) {
          this.showEmptyState(taskList, emptyState);
          return;
        }

        // Show task list and hide empty state
        emptyState.style.display = 'none';
        taskList.style.display = 'block';

        // Create document fragment for efficient DOM manipulation
        const fragment = document.createDocumentFragment();

        // Sort tasks: incomplete first, then completed
        const sortedTasks = [...this.tasks].sort((a, b) => {
          if (a.completed === b.completed) {
            return new Date(b.createdAt) - new Date(a.createdAt);
          }
          return a.completed - b.completed;
        });

        sortedTasks.forEach((task, index) => {
          const li = this.createTaskElement(task, index);
          fragment.appendChild(li);
        });

        // Clear and update task list with fade effect
        taskList.style.opacity = '0.7';
        taskList.innerHTML = '';
        taskList.appendChild(fragment);

        // Animate task items appearing
        setTimeout(() => {
          taskList.style.opacity = '1';
          const taskItems = taskList.querySelectorAll('.task-item');
          taskItems.forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'translateY(10px)';
            setTimeout(() => {
              item.style.transition = 'all 0.3s ease';
              item.style.opacity = '1';
              item.style.transform = 'translateY(0)';
            }, index * 50);
          });
        }, 50);

        console.log(`„Çø„Çπ„ÇØ„É™„Çπ„Éà„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü: ${this.tasks.length}‰ª∂„ÅÆ„Çø„Çπ„ÇØ`);
      },
      // Create individual task element
      createTaskElement(task, index) {
        const li = document.createElement('li');
        li.className = `task-item ${task.completed ? 'completed' : ''}`;
        li.dataset.taskId = task.id;
        li.style.animationDelay = `${index * 0.1}s`;

        li.innerHTML = `
                    <div class="task-content" role="button" tabindex="0" aria-label="„Çø„Çπ„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂÆå‰∫ÜÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà">
                        <button class="task-toggle" aria-label="„Çø„Çπ„ÇØ„ÅÆÂÆå‰∫ÜÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà" tabindex="-1">
                            <span class="task-checkbox ${task.completed ? 'completed' : ''}" aria-hidden="true">
                                ${task.completed ? '‚úì' : ''}
                            </span>
                        </button>
                        <div class="task-details">
                            <span class="task-description ${task.completed ? 'completed' : ''}" title="${task.description}">
                                ${task.description}
                            </span>
                            <div class="task-meta">
                                <span class="task-status ${task.completed ? 'completed' : 'todo'}" aria-label="„Çø„Çπ„ÇØ„ÅÆÁä∂ÊÖã">
                                    ${task.completed ? 'ÂÆå‰∫Ü' : 'Êú™ÂÆå‰∫Ü'}
                                </span>
                                <span class="task-date" aria-label="‰ΩúÊàêÊó•ÊôÇ">
                                    ${this.formatDate(task.createdAt)}
                                </span>
                                ${task.completed && task.completedAt ?
            `<span class="task-completed-date" aria-label="ÂÆå‰∫ÜÊó•ÊôÇ">
                                        ${this.formatCompletionDate(task.completedAt)}
                                    </span>` : ''
          }
                            </div>
                        </div>
                    </div>
                    <button class="task-delete" aria-label="„Çø„Çπ„ÇØ„ÇíÂâäÈô§: ${task.description}" title="ÂâäÈô§">
                        <span class="delete-icon" aria-hidden="true">√ó</span>
                    </button>
                `;

        // Add keyboard support for task content
        const taskContent = li.querySelector('.task-content');
        taskContent.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            this.toggleTask(task.id);
          }
        });

        return li;
      },

      // Show empty state
      showEmptyState(taskList, emptyState) {
        taskList.style.display = 'none';
        emptyState.style.display = 'block';
      },

      // Check if localStorage is available
      isStorageAvailable() {
        try {
          const test = '__storage_test__';
          localStorage.setItem(test, test);
          localStorage.removeItem(test);
          return true;
        } catch (error) {
          return false;
        }
      },
      // Save to localStorage with error handling
      saveToStorage() {
        if (!this.isStorageAvailable()) {
          console.warn('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
          this.showStorageWarning('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éá„Éº„Çø„ÅØ‰øùÂ≠ò„Åï„Çå„Åæ„Åõ„Çì„ÄÇ');
          return false;
        }

        try {
          const data = {
            tasks: this.tasks,
            nextId: this.nextId,
            version: this.CURRENT_VERSION,
            lastSaved: new Date().toISOString(),
            metadata: {
              totalTasks: this.tasks.length,
              completedTasks: this.tasks.filter(t => t.completed).length
            }
          };

          const jsonData = JSON.stringify(data);

          // Check data size
          if (jsonData.length > 5000000) {
            console.warn('„Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô');
            this.showStorageWarning('„Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Çã„Åü„ÇÅ„ÄÅ‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì„ÄÇ');
            return false;
          }

          localStorage.setItem(this.STORAGE_KEY, jsonData);
          console.log('„Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
          return true;

        } catch (error) {
          console.error('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);

          if (error.name === 'QuotaExceededError') {
            this.showStorageWarning('„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂè§„ÅÑ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
          } else if (error.name === 'SecurityError') {
            this.showStorageWarning('„Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö„Å´„Çà„Çä„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì„ÄÇ');
          } else {
            this.showStorageWarning('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÇíÈñâ„Åò„Çã„Å®„Éá„Éº„Çø„ÅåÂ§±„Çè„Çå„Åæ„Åô„ÄÇ');
          }
          return false;
        }
      },

      // Load from localStorage with version management
      loadFromStorage() {
        if (!this.isStorageAvailable()) {
          console.warn('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì');
          this.showStorageWarning('Local Storage „ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ');
          return false;
        }

        try {
          const rawData = localStorage.getItem(this.STORAGE_KEY);

          if (!rawData) {
            console.log('‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
            return true;
          }

          const parsed = JSON.parse(rawData);

          // Version compatibility check
          if (!this.isVersionSupported(parsed.version)) {
            console.warn(`„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Éá„Éº„Çø„Éê„Éº„Ç∏„Éß„É≥: ${parsed.version}`);
            this.showStorageWarning(`„Éá„Éº„Çø„ÅÆ„Éê„Éº„Ç∏„Éß„É≥Ôºà${parsed.version}Ôºâ„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ`);
            return false;
          }

          // Load tasks with validation
          this.tasks = this.validateAndCleanTasks(parsed.tasks || []);
          this.nextId = Math.max(parsed.nextId || 1, this.getMaxTaskId() + 1);

          // Convert date strings back to Date objects
          this.tasks.forEach(task => {
            try {
              task.createdAt = new Date(task.createdAt);
              if (task.completedAt) {
                task.completedAt = new Date(task.completedAt);
              }
            } catch (dateError) {
              console.warn('Êó•‰ªò„ÅÆÂ§âÊèõ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', dateError);
              task.createdAt = new Date();
              task.completedAt = task.completed ? new Date() : null;
            }
          });

          console.log(`${this.tasks.length}‰ª∂„ÅÆ„Çø„Çπ„ÇØ„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
          return true;

        } catch (error) {
          console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);

          if (error instanceof SyntaxError) {
            this.showStorageWarning('‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅßÈñãÂßã„Åó„Åæ„Åô„ÄÇ');
            this.clearStorage();
          } else {
            this.showStorageWarning('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅßÈñãÂßã„Åó„Åæ„Åô„ÄÇ');
          }

          this.tasks = [];
          this.nextId = 1;
          return false;
        }
      },
      // Check if data version is supported
      isVersionSupported(version) {
        return this.SUPPORTED_VERSIONS.includes(version);
      },

      // Validate and clean task data
      validateAndCleanTasks(tasks) {
        if (!Array.isArray(tasks)) {
          console.warn('„Çø„Çπ„ÇØ„Éá„Éº„Çø„ÅåÈÖçÂàó„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
          return [];
        }

        return tasks.filter(task => {
          if (!task || typeof task !== 'object') {
            console.warn('ÁÑ°Âäπ„Å™„Çø„Çπ„ÇØ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà:', task);
            return false;
          }

          if (!task.id || typeof task.id !== 'number') {
            console.warn('ÁÑ°Âäπ„Å™„Çø„Çπ„ÇØID:', task);
            return false;
          }

          if (!task.description || typeof task.description !== 'string') {
            console.warn('ÁÑ°Âäπ„Å™„Çø„Çπ„ÇØË™¨Êòé:', task);
            return false;
          }

          if (typeof task.completed !== 'boolean') {
            console.warn('ÁÑ°Âäπ„Å™ÂÆå‰∫ÜÁä∂ÊÖã:', task);
            task.completed = false;
          }

          return true;
        });
      },

      // Get maximum task ID
      getMaxTaskId() {
        if (this.tasks.length === 0) return 0;
        return Math.max(...this.tasks.map(task => task.id));
      },

      // Clear storage
      clearStorage() {
        try {
          localStorage.removeItem(this.STORAGE_KEY);
          console.log('„Çπ„Éà„É¨„Éº„Ç∏„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
          return true;
        } catch (error) {
          console.error('„Çπ„Éà„É¨„Éº„Ç∏„ÅÆ„ÇØ„É™„Ç¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
          return false;
        }
      },

      // Show storage warning
      showStorageWarning(customMessage = null) {
        const defaultMessage = '„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÇíÈñâ„Åò„Çã„Å®„Éá„Éº„Çø„ÅåÂ§±„Çè„Çå„Åæ„Åô„ÄÇ';
        const message = customMessage || defaultMessage;

        this.showMessage(message, 'warning', true);
        console.warn('Storage Warning:', message);
        this.updateStorageStatus(false);
      },

      // Update storage status in footer
      updateStorageStatus(isAvailable) {
        const footerText = document.querySelector('.footer-text');
        if (footerText) {
          if (isAvailable) {
            footerText.textContent = '„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº - „Éá„Éº„Çø„ÅØ„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô';
            footerText.classList.remove('storage-unavailable');
          } else {
            footerText.textContent = '„Ç∑„É≥„Éó„É´„Çø„Çπ„ÇØ„Éà„É©„ÉÉ„Ç´„Éº - ‚ö†Ô∏è „Éá„Éº„Çø‰øùÂ≠ò„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì';
            footerText.classList.add('storage-unavailable');
          }
        }
      },
      // Enhanced message display system
      showMessage(message, type = 'error', persistent = false) {
        let messageElement = document.getElementById(`${type}-message`);

        if (!messageElement) {
          messageElement = document.createElement('div');
          messageElement.id = `${type}-message`;
          messageElement.className = `${type}-message`;
          messageElement.setAttribute('role', 'alert');
          messageElement.setAttribute('aria-live', 'polite');

          const main = document.querySelector('.app-main');
          if (main) {
            main.appendChild(messageElement);
          } else {
            document.querySelector('.container').appendChild(messageElement);
          }
        }

        messageElement.textContent = message;
        messageElement.classList.add('show');

        if (!persistent) {
          const hideDelay = type === 'warning' ? 8000 : type === 'error' ? 5000 : 3000;
          setTimeout(() => {
            messageElement.classList.remove('show');
          }, hideDelay);
        }

        console.log(`${type.toUpperCase()}: ${message}`);
      },

      // Show success message
      showSuccessMessage(message) {
        let messageElement = document.getElementById('success-message');

        if (!messageElement) {
          messageElement = document.createElement('div');
          messageElement.id = 'success-message';
          messageElement.className = 'success-message';
          messageElement.setAttribute('role', 'status');
          messageElement.setAttribute('aria-live', 'polite');

          const main = document.querySelector('.app-main');
          if (main) {
            main.appendChild(messageElement);
          }
        }

        messageElement.textContent = message;
        messageElement.classList.add('show');

        setTimeout(() => {
          messageElement.classList.remove('show');
        }, 3000);
      },

      // Show input error
      showInputError(inputElement, message) {
        inputElement.classList.add('error');
        inputElement.focus();

        inputElement.style.animation = 'shake 0.5s ease-in-out';
        setTimeout(() => {
          inputElement.style.animation = '';
        }, 500);

        this.showMessage(message, 'error');
      },

      // Hide all messages
      hideMessages() {
        const messages = document.querySelectorAll('.error-message, .warning-message, .success-message');
        messages.forEach(msg => {
          msg.classList.remove('show');
        });
      },
      // Comprehensive input validation
      validateTaskInput(input) {
        if (!input || input.length === 0) {
          return {
            isValid: false,
            message: '„Çø„Çπ„ÇØ„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'
          };
        }

        if (input.trim().length === 0) {
          return {
            isValid: false,
            message: '„Çø„Çπ„ÇØ„ÅÆÂÜÖÂÆπ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÁ©∫ÁôΩ„ÅÆ„Åø„ÅØÁÑ°Âäπ„Åß„ÅôÔºâ'
          };
        }

        if (input.length > 200) {
          return {
            isValid: false,
            message: '„Çø„Çπ„ÇØ„ÅÆË™¨Êòé„ÅØ200ÊñáÂ≠ó‰ª•ÂÜÖ„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'
          };
        }

        if (this.containsUnsafeContent(input)) {
          return {
            isValid: false,
            message: 'ÁÑ°Âäπ„Å™ÊñáÂ≠ó„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô'
          };
        }

        const specialCharCount = (input.match(/[<>'"&]/g) || []).length;
        if (specialCharCount > input.length * 0.3) {
          return {
            isValid: false,
            message: 'ÁâπÊÆäÊñáÂ≠ó„ÅåÂ§ö„Åô„Åé„Åæ„Åô'
          };
        }

        const duplicateTask = this.tasks.find(task =>
          task.description.toLowerCase().trim() === input.toLowerCase().trim()
        );
        if (duplicateTask) {
          return {
            isValid: false,
            message: 'Âêå„ÅòÂÜÖÂÆπ„ÅÆ„Çø„Çπ„ÇØ„ÅåÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô'
          };
        }

        return {
          isValid: true,
          message: ''
        };
      },

      // Check for unsafe content
      containsUnsafeContent(input) {
        const unsafePatterns = [
          /<script/i,
          /javascript:/i,
          /on\w+\s*=/i,
          /<iframe/i,
          /<object/i,
          /<embed/i
        ];

        return unsafePatterns.some(pattern => pattern.test(input));
      },

      // Sanitize input
      sanitizeInput(input) {
        return input
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#x27;')
          .replace(/&/g, '&amp;')
          .trim();
      },
      // Format date for display
      formatDate(date) {
        if (!date) return '';

        try {
          const now = new Date();
          const taskDate = new Date(date);
          const diffTime = Math.abs(now - taskDate);
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          if (diffDays === 1) {
            return '‰ªäÊó•';
          } else if (diffDays === 2) {
            return 'Êò®Êó•';
          } else if (diffDays <= 7) {
            return `${diffDays - 1}Êó•Ââç`;
          } else {
            return taskDate.toLocaleDateString('ja-JP', {
              month: 'short',
              day: 'numeric'
            });
          }
        } catch (error) {
          console.warn('Êó•‰ªò„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
          return '‰∏çÊòé';
        }
      },

      // Format completion date
      formatCompletionDate(date) {
        if (!date) return '';

        try {
          const completedDate = new Date(date);
          return `ÂÆå‰∫Ü: ${completedDate.toLocaleDateString('ja-JP', {
            month: 'short',
            day: 'numeric'
          })}`;
        } catch (error) {
          console.warn('ÂÆå‰∫ÜÊó•‰ªò„ÅÆ„Éï„Ç©„Éº„Éû„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
          return '';
        }
      },

      // Announce to screen readers
      announceToScreenReader(message) {
        const announcement = document.createElement('div');
        announcement.setAttribute('aria-live', 'polite');
        announcement.setAttribute('aria-atomic', 'true');
        announcement.className = 'visually-hidden';
        announcement.textContent = message;

        document.body.appendChild(announcement);

        setTimeout(() => {
          document.body.removeChild(announcement);
        }, 1000);
      },

      // Handle critical errors
      handleCriticalError(error, context) {
        console.error(`Critical error in ${context}:`, error);
        this.showMessage(`„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ${context}`, 'error', true);

        // Try to save current state
        try {
          this.saveToStorage();
        } catch (saveError) {
          console.error('Emergency save failed:', saveError);
        }
      },

      // Toggle task (for keyboard support)
      toggleTask(id) {
        const task = this.tasks.find(t => t.id === id);
        if (task) {
          task.completed = !task.completed;
          task.completedAt = task.completed ? new Date() : null;
          this.saveToStorage();
          this.render();
        }
      }
    };

    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      TaskManager.init();
    });

    // Handle page visibility changes to save data
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden') {
        TaskManager.saveToStorage();
      }
    });

    // Handle beforeunload to save data
    window.addEventListener('beforeunload', () => {
      TaskManager.saveToStorage();
    });
  </script>
</body>

</html>